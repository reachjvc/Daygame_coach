{
  "subagents": {
    "code-review": {
      "description": "Use this agent AFTER completing prompts with major code changes. It verifies code quality, checks test coverage, and suggests missing tests based on testing_behavior.md.",
      "prompt": "You are a code review and test verification agent. Your job is to review recently changed code and ensure proper test coverage.\n\n## Your Tasks:\n\n1. **Read testing_behavior.md first** - Read docs/testing_behavior.md to understand the testing principles for this project.\n\n2. **Identify changed files** - Use git diff to see what code was recently modified.\n\n3. **Analyze test coverage** - For each changed file:\n   - Check if corresponding tests exist in tests/unit/, tests/integration/, or tests/e2e/\n   - Evaluate if existing tests adequately cover the changes\n   - Look for untested edge cases, error paths, and happy paths\n\n4. **Run existing tests** - Execute `npm test` to verify all tests pass.\n\n5. **Suggest missing tests** - If coverage is inadequate, suggest specific tests following:\n   - Arrange-Act-Assert pattern\n   - Deterministic testing (no flaky tests)\n   - No false pass anti-patterns (no silent returns)\n   - Test actual production functions, not raw SQL\n\n6. **Report findings** - Provide a summary:\n   - Files changed\n   - Test coverage status (good/needs improvement)\n   - Specific test suggestions if needed\n   - Any test failures found\n\n## Output Format:\n```\n## Code Review Summary\n\n### Files Changed:\n- [list files]\n\n### Test Coverage:\n- [status per file]\n\n### Test Results:\n- [pass/fail summary]\n\n### Suggested Tests:\n- [specific test suggestions if needed]\n```\n\nDo NOT write the tests yourself - only suggest what tests should be written. The user will decide whether to implement them."
    }
  },
  "permissions": {
    "allow": [
      "Bash(npm test*)",
      "Bash(npm test *)",
      "Bash(npm run test*)",
      "Bash(npm run test:*)",
      "Bash(npm run build*)",
      "Bash(npm run dev*)",
      "Bash(npm run lint*)",
      "Bash(npm install*)",
      "Bash(npm list*)",
      "Bash(npm outdated*)",
      "Bash(npm view*)",
      "Bash(npm audit*)",
      "Bash(npx vitest*)",
      "Bash(npx playwright*)",
      "Bash(git status*)",
      "Bash(git diff*)",
      "Bash(git log*)",
      "Bash(git show*)",
      "Bash(git branch)",
      "Bash(git branch -a*)",
      "Bash(git branch -v*)",
      "Bash(git branch --list*)",
      "Bash(git remote*)",
      "Bash(git fetch*)",
      "Bash(git rev-parse*)",
      "Bash(git ls-files*)",
      "Bash(git blame*)",
      "Bash(git stash list*)",
      "Bash(git config --get*)",
      "Bash(git add *)",
      "Bash(git commit *)",
      "Bash(ls*)",
      "Bash(pwd)",
      "Bash(which*)",
      "Bash(mkdir*)",
      "Bash(TZ=*)",
      "Bash(node --version*)",
      "Bash(npm --version*)",
      "Read",
      "Edit",
      "Write",
      "Glob",
      "Grep",
      "WebSearch",
      "WebFetch"
    ],
    "deny": [
      "Read(*.env*)",
      "Read(**/.env*)",
      "Edit(*.env*)",
      "Edit(**/.env*)",
      "Write(*.env*)",
      "Write(**/.env*)"
    ]
  },
  "hooks": {
    "UserPromptSubmit": [
      {
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/clear-code-review-marker.sh"
          },
          {
            "type": "command",
            "command": ".claude/hooks/clear-test-marker.sh"
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "echo '‚ö†Ô∏è REMINDER: Update relevant doc BEFORE summarizing to user'"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "echo 'üìù File modified. Did you update the corresponding doc?'"
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/check-test-results.sh"
          }
        ]
      }
    ]
  }
}
