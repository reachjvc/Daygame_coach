#!/usr/bin/env bash
#
# scripts/training-data/06b.LLM.reverify
#
# Re-run Stage 06b verifier against patched Stage 06c outputs.
# This is a thin wrapper around 06b.LLM.verify with different default roots.

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(cd "${SCRIPT_DIR}/../.." && pwd)"
VERIFY_SCRIPT="${SCRIPT_DIR}/06b.LLM.verify"

if [[ ! -x "$VERIFY_SCRIPT" ]]; then
  echo "[06b.LLM.reverify] ERROR: verifier script not executable: $VERIFY_SCRIPT" >&2
  exit 1
fi

input_root="data/06c.DET.patched"
output_root="data/06b.LLM.reverify"

input_override=false
output_override=false
has_test=false
reject_behavior_override=false

for arg in "$@"; do
  case "$arg" in
    --test)
      has_test=true
      ;;
    --input|--input=*|--input-root|--input-root=*)
      input_override=true
      ;;
    --output|--output=*)
      output_override=true
      ;;
    --allow-reject-verdicts)
      reject_behavior_override=true
      ;;
  esac
done

if [[ "$has_test" == true ]]; then
  input_root="data/test/06c.patched"
  output_root="data/test/06b.reverify"
fi

cmd=("$VERIFY_SCRIPT")
if [[ "$input_override" == false ]]; then
  cmd+=(--input-root "$input_root")
fi
if [[ "$output_override" == false ]]; then
  cmd+=(--output "$output_root")
fi
if [[ "$reject_behavior_override" == false ]]; then
  cmd+=(--allow-reject-verdicts)
fi
cmd+=("$@")

exec "${cmd[@]}"
