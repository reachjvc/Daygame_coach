{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "verification.schema.json",
  "title": "Stage 06b Verification Output",
  "description": "Schema for LLM verification of Stage 06 outputs.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "video_id": {
      "type": "string",
      "pattern": "^[A-Za-z0-9_-]{11}$"
    },
    "verified_at": {
      "type": "string"
    },
    "pipeline_version": {
      "type": "string"
    },
    "verdict": {
      "type": "string",
      "enum": ["APPROVE", "FLAG", "REJECT"],
      "description": "Overall verification verdict."
    },
    "video_type_check": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "agrees": {
          "type": "boolean",
          "description": "Whether the verifier agrees with the Stage 06 video type."
        },
        "suggested_type": {
          "type": ["string", "null"],
          "enum": ["infield", "compilation", "talking_head", "podcast", null],
          "description": "Suggested replacement type (null when agrees=true)."
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Confidence in video_type_check assessment."
        },
        "reasoning": {
          "type": "string",
          "description": "Brief explanation for agreement/disagreement."
        }
      },
      "required": ["agrees", "suggested_type", "confidence", "reasoning"]
    },
    "conversation_verdicts": {
      "type": "array",
      "description": "Per-conversation quality verdicts.",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "conversation_id": {
            "type": "integer",
            "minimum": 1
          },
          "verdict": {
            "type": "string",
            "enum": ["OK", "FLAG", "ISSUE"]
          },
          "notes": {
            "type": "string"
          }
        },
        "required": ["conversation_id", "verdict", "notes"]
      }
    },
    "misattributions": {
      "type": "array",
      "description": "Segments with likely incorrect speaker_role.",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "segment_id": {
            "type": "integer",
            "minimum": 0
          },
          "current_role": {
            "type": "string",
            "enum": ["coach", "student", "target", "other", "voiceover", "unknown"]
          },
          "suggested_role": {
            "type": "string",
            "enum": ["coach", "student", "target", "other", "voiceover"]
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "evidence": {
            "type": "string"
          }
        },
        "required": ["segment_id", "current_role", "suggested_role", "confidence", "evidence"]
      }
    },
    "boundary_issues": {
      "type": "array",
      "description": "Conversation boundary concerns and optional deterministic fixes.",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "conversation_id": {
            "type": "integer",
            "minimum": 1
          },
          "issue": {
            "type": "string"
          },
          "severity": {
            "type": "string",
            "enum": ["minor", "moderate", "major"]
          },
          "suggested_fix": {
            "oneOf": [
              {
                "type": "string",
                "enum": ["merge_with_next", "merge_with_previous", "reclassify_as_commentary"]
              },
              {
                "type": "string",
                "pattern": "^split_at_segment_[0-9]+$"
              },
              {
                "type": "null"
              }
            ]
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          }
        },
        "required": ["conversation_id", "issue", "severity", "suggested_fix", "confidence"]
      }
    },
    "collapse_issues": {
      "type": "array",
      "description": "Collapsed-speaker override correction suggestions.",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "speaker_id": {
            "type": "string",
            "minLength": 1
          },
          "segment_id": {
            "type": "integer",
            "minimum": 0
          },
          "current_override": {
            "type": ["string", "null"],
            "enum": ["coach", "student", "target", "other", null]
          },
          "suggested_override": {
            "type": "string",
            "enum": ["coach", "student", "target", "other"]
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "evidence": {
            "type": "string"
          }
        },
        "required": ["speaker_id", "segment_id", "current_override", "suggested_override", "confidence", "evidence"]
      }
    },
    "other_flags": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "metadata": {
      "type": "object"
    },
    "summary": {
      "type": "string"
    }
  },
  "required": [
    "video_id",
    "verified_at",
    "pipeline_version",
    "verdict",
    "video_type_check",
    "conversation_verdicts",
    "misattributions",
    "boundary_issues",
    "collapse_issues",
    "other_flags",
    "metadata",
    "summary"
  ]
}
